var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a){if(a){for(var b=ba,c=["Array","prototype","fill"],d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&aa(b,c,{configurable:!0,writable:!0,value:a})}}
ca(function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}});
var g=function(){var a=document.documentElement.style,b=void 0!==a.WebkitTransform&&"-webkit-"||void 0!==a.MozTransform&&"-moz-"||void 0!==a.msTransform&&"-ms-"||"";return{translate:function(a,d,e,f,h,p){return b+"transform:translate3d("+a+"px,"+d+"px,"+e+"px)rotateX("+f+"deg)rotateY("+h+"deg)rotateZ("+p+"deg);"},origin:function(a,d,e){return b+"transform-origin:"+a+"px "+d+"px "+e+"px;"},o:function(a){return"background:"+a+";"}}}(),m=[];function n(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}
function q(){this.i=null;this.a=new n(0,0,0);this.b=new n(0,0,0)}q.prototype={};function r(a){a.i&&(a.i.node.style.cssText=g.origin(-a.a.x,-a.a.y,-a.a.z)+g.translate(a.a.x,a.a.y,700,a.b.x,a.b.y,a.b.z),m.forEach(function(b){b.node.style.cssText=g.translate(b.x,b.y,-b.z,270,90+180*-Math.atan2(-a.a.y-b.y,-a.a.x-b.x)/Math.PI,180)+"width:"+b.width+"px;height:"+b.height+"px;"}))}
function t(a,b,c,d,e,f,h,p,N){"div"==a?(this.node=document.createElement("div"),this.node.className="plane wall"):"ceil"==a?(this.node=document.createElement("div"),this.node.className="plane ceil"):"floor"==a?(this.node=document.createElement("div"),this.node.className="plane floor"):"background"==a?(this.node=document.createElement("canvas"),this.node.className="plane background",this.node.height=c/4,this.node.width=b/4):"glitch"==a?(this.node=document.createElement("canvas"),this.node.className=
"plane glitch"):"data"==a&&(this.node=document.createElement("canvas"),this.node.className="plane data");this.width=b;this.height=c;this.a=new n(d,e,f);this.b=new n(h,p,N);this.g=function(){this.node.style.cssText+="width:"+this.width+"px;height:"+this.height+"px;"+g.translate(this.a.x,this.a.y,this.a.z,this.b.x,this.b.y,this.b.z)};this.g()}
function da(a){this.node=document.createElement("div");this.node.className="world";a.node.appendChild(this.node);a.c.i=this;this.f=function(a){this.node.appendChild(a.node)};this.a=function(){this.node.innerHTML=""}}function ea(){var a=document.body;this.node=document.createElement("div");this.node.className="viewport";this.c=new q;a.appendChild(this.node)}
var u=[Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random()],v=[-20,20,60,100,140,180,220,260],w=[],x,y,z,A=0;
function B(){z=document.getElementsByClassName("background");.3>Math.random()&&(u.push(Math.random()),v.push(-20));for(var a=0;a<z.length;a++){var b=z[a];w[a]=b.getContext("2d");w[a].font="10px monospace";x=b.width;y=b.height;w[a].clearRect(0,0,x,y);for(b=0;b<u.length;b++)for(var c=0;7>c;c++)w[a].fillStyle="rgba(0,255,0,0."+(7-c)+")",w[a].fillText(Math.floor(9*Math.random()),u[b]*x,v[b]-10*c)}for(b=0;b<u.length;b++)v[b]+=4,v[b]>y+160&&(v.splice(b,1),u.splice(b,1),b--);setTimeout(B,100)}
function C(){for(var a=document.getElementsByClassName("glitch"),b=["6,7,96","222,236,6","235,236,237","6,24,114","12,11,11"],c=0;c<a.length;c++){var d=a[c],e=d.getContext("2d"),f=d.width;d=d.height;e.clearRect(0,0,f,d);e.beginPath();e.fillStyle="darkGreen";a[c].classList.contains("targeting")&&(e.fillStyle="red");e.rect(f/4,d/4,f/2,d/2);e.fill();for(var h=0;5>h;h++){e.beginPath();e.fillStyle="rgba("+b[Math.floor(Math.random()*b.length)]+","+parseInt(a[c].classList[0],10)/100+")";var p=Math.random()*
f,N=Math.random()*d,k=Math.random()*f,l=Math.random()*d;e.rect(Math.min(p,k),Math.min(N,l),Math.abs(p-k),Math.abs(N-l));e.fill()}}setTimeout(C,150)}
function fa(){var a=document.getElementsByClassName("data");A+=10;200<A&&(A=10);for(var b=0;b<a.length;b++){var c=a[b],d=c.getContext("2d"),e=c.width,f=c.height;d.clearRect(0,0,e,f);c.width=200;c.height=500;d.font="20px monospace";d.fillStyle="white";d.fillText("Protect me",-A,f/2);d.fillText("Protect me",e-A,f/2);for(c=0;100>c;c++)d.fillText(Math.floor(9*Math.random()),e*Math.random(),f-(f/2-50)*Math.random());for(c=0;100>c;c++)d.fillText(Math.floor(9*Math.random()),e*Math.random(),(f/2-50)*Math.random())}setTimeout(fa,
150)}
function ha(){D=[];E=0;var a;a:{var b=decodeURIComponent(document.cookie).split(";");for(a=0;a<b.length;a++){for(var c=b[a];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf("save=")){a=c.substring(5,c.length);break a}}a=""}if(a.constructor===String&&0<a.length&&(a=JSON.parse(a),a.constructor===Array)){E=a[0];0<E&&(document.getElementById("continueButton").className="option");for(b=1;b<a.length;b++)D.push(a[b]);if(0<D.length){a="<h2>Scores</h2>";for(b=0;b<D.length;b++)a+="<li>"+D[b]+" ticks</li>";document.getElementById("stats").innerHTML=
a;document.getElementById("statButton").className="option"}else document.getElementById("statButton").className="option option-disabled"}}
function ia(a,b){this.x=a;this.y=b;this.a=this.z=100;this.speed=2;this.height=this.width=300;this.h=!1;this.b=new t("glitch",300,300,this.x,this.y,this.z,270,270,180);this.node=this.b.node;F.f(this.b);m.push(this);this.frame=function(a,b){var c=!0;var d=this.x;var h=this.y;d=0>d||0>h||d>=G.length*H||h>=G[0].length*H?0:G[Math.floor(d/H)][Math.floor(h/H)];this.a+=.01;100<this.a&&(this.a=100);if(this.j(a,b,0))a=Math.atan2(b-this.y,a-this.x),this.node.className=this.a+" plane glitch targeting";else{if(0==
d||5==d)c=!1;a=(270+[-1,45,270,135,180,0,0,295,90,225][d])*Math.PI/180;this.node.className=this.a+" plane glitch"}c&&(this.x+=this.speed*Math.cos(a),this.y+=this.speed*Math.sin(a));return 5==d?!0:!1};this.j=function(a,b,e){return(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<e*e};this.delete=function(){this.node.remove();for(var a=0;a<m.length;a++)m[a]===this&&m.splice(a,1)}}var I=0,J=0,K=0,L=270,M=0,O=1E3,P=1E3,ja=150,Q,G,H,R,S=[],D=[],E=0,T=0,U=[20,100,300];
function ka(){la(0);this.a=!1;this.m=function(){la(1);this.a=!0;K=0};this.frame=function(){K++;document.getElementById("frameAlive").innerHTML=Math.floor(K/100);this.a?(V[83]?-10<I&&(I-=.2):V[90]?10>I&&(I+=.2):.4>Math.abs(I)?I=0:I/=1.1,V[81]?-10<J&&(J-=.2):V[68]?10>J&&(J+=.2):.4>Math.abs(J)?J=0:J/=1.1):(J=3,M-=.12);var a=Math.sin(.0174532925*M),b=Math.cos(.0174532925*M),c=O,d=P;O+=a*I;P+=b*I;ja+=0;P-=a*J;O+=b*J;W(O,P)||(W(c,P)?O=c:W(O,d)?P=d:W(c,d)?(O=c,P=d):console.log("error !"));if(X)T++;else{for(a=
U.length-1;0<=a;a--)if(T>U[a]){this.l(a);break}T=0}b=!1;for(a=0;a<R.length;a++)R[a].frame(O,P)?(b=!0,R[a].h=!0):R[a].j(O,P,100)&&(console.log("dead"),R[a].h=!0);for(a=R.length-1;0<=a;a--)R[a].h&&(R[a].delete(),R.splice(a,1));b&&this.g();1==K%1E3&&this.a&&S&&0<S.length&&(a=S[Math.floor(S.length*Math.random())],R.push(new ia(a.x,a.y)))};this.l=function(a){switch(a){case 0:console.log("basic attack");break;case 1:console.log("middle attack");break;case 2:console.log("strong attack")}};this.g=function(){console.log("data corrupted !")};
this.b=function(a,b){L+=a;M+=b;230>L&&(L=230);320<L&&(L=320)}}var V={};window.onkeydown=function(a){a=a||window.event;V[a.keyCode]=!0};window.onkeyup=function(a){a=a||window.event;delete V[a.keyCode]};var X=0;function ma(a,b,c,d){var e=F;e.f(new t(d,c,500,a+c,b,-447,270,90,180));e.f(new t(d,c,500,a+c,b+c,-447,270,0,180));e.f(new t(d,c,500,a,b,-447,270,180,180));e.f(new t(d,c,500,a,b+c,-447,270,270,180))}var F;
window.onload=function(){function a(b){if(1E3<b-f)window.requestAnimationFrame(a),f=b;else{h+=b-f;for(f=b;16<=h;)d.frame(),c.c.a.x=-O,c.c.a.y=-P,c.c.a.z=ja,c.c.b.x=L,c.c.b.y=0,c.c.b.z=M,r(c.c),h-=16;var e=document.getElementById("attackLoader");b=e.getContext("2d");var k=e.offsetWidth,l=e.offsetHeight,p=k/l;b.clearRect(0,0,k,l);1>p?(e.width=800,e.height=800/p,k=800,l=800/p):(e.width=800*p,e.height=800,k=800*p,l=800);b.strokeStyle="rgba(255,255,255,0.4)";b.lineWidth=3;b.beginPath();b.arc(k/2,l/2,5,
0,2*Math.PI);b.stroke();b.strokeStyle="rgba(255,255,255,1)";0<T&&(e=T/U[0],b.lineWidth=3,b.beginPath(),b.arc(k/2,l/2,5,0,2*Math.PI*e),b.stroke());T>U[0]&&(b.lineWidth=4,b.beginPath(),b.arc(k/2,l/2,5,0,2*Math.PI),b.stroke(),b.strokeStyle="rgba(255,255,255,0.7)",e=(T-U[0])/(U[1]-U[0]),b.lineWidth=3,b.beginPath(),b.arc(k/2,l/2,10,0,2*Math.PI*e),b.stroke());T>U[1]&&(b.lineWidth=4,b.beginPath(),b.arc(k/2,l/2,10,0,2*Math.PI),b.stroke(),b.strokeStyle="rgba(255,255,255,0.7)",e=(T-U[1])/(U[2]-U[1]),b.lineWidth=
3,b.beginPath(),b.arc(k/2,l/2,15,0,2*Math.PI*e),b.stroke());T>U[2]&&(b.lineWidth=4,b.beginPath(),b.arc(k/2,l/2,15,0,2*Math.PI),b.stroke());window.requestAnimationFrame(a)}}function b(a){d.b(.5*-a.movementY,a.movementX/2)}document.body.onmousedown=function(){++X};document.body.onmouseup=function(){--X};ha();var c=new ea;F=new da(c);var d=new ka;c.c.a.x=0;c.c.a.y=0;c.c.a.z=150;c.c.b.x=270;c.c.b.y=0;c.c.b.z=0;r(c.c);document.getElementById("statButton").onclick=function(){document.getElementById("stats").className=
"stats"};var e=document.getElementsByTagName("BODY")[0];e.requestPointerLock=e.requestPointerLock;document.getElementById("survivalButton").onclick=function(){e.onclick=function(){e.requestPointerLock()};e.requestPointerLock();document.getElementById("ingame").className="";d.m();document.getElementById("menu").classList.add("hidden")};document.addEventListener("pointerlockchange",function(){document.pointerLockElement===e?document.addEventListener("mousemove",b,!1):document.removeEventListener("mousemove",
b,!1)},!1);var f=0,h=0;a(0);B();C();fa()};
function la(a){S=[];H=400;0==a?(Q=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],P=O=700,M=45):1==a?(Q=[[3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0],[3,0,0,0,0,0,1,2,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0],[3,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,0,0,0,0,0,0]],O=1800,P=4200,M=180):2==a&&
(Q=[[0,0,0,0,2],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[3,0,0,0,0]],P=O=1800,M=180);R=[];na();a=Q;var b=H;F.a();var c=a.length*b,d=a[0].length*b;F.f(new t("floor",c,d,0,d,53,180,0,0));F.f(new t("ceil",c,d,0,0,-447,0,0,0));for(var e=0;e<a.length;e++)for(var f=0;f<a[e].length;f++)1==a[e][f]&&ma(e*b,f*b,b,"div"),2==a[e][f]&&ma(e*b+b/4,f*b+b/4,b/2,"data"),3==a[e][f]&&S.push({x:e*b+b/2,y:f*b+b/2});F.f(new t("background",d,500,0,0,-447,270,90,180));F.f(new t("background",c,500,c,0,-447,270,0,180));F.f(new t("background",
c,500,0,d,-447,270,180,180));F.f(new t("background",d,500,c,d,-447,270,270,180))}
function na(){G=[];for(var a=[],b=0;b<Q.length;b++){G.push([]);for(var c=0;c<Q[0].length;c++)2==Q[b][c]&&a.push([b,c,5,0]),G[b].push(-1)}for(;0<a.length;){a.sort(function(a,b){return a[3]-b[3]});b=a[0];a.splice(0,1);c=b[0];var d=b[1],e=b[3];0<=c&&c<Q.length&&0<=d&&d<Q[0].length&&(1==Q[c][d]?G[c][d]=0:-1==G[c][d]&&(a.push([c+1,d,2,e+2]),a.push([c-1,d,8,e+2]),a.push([c,d+1,6,e+2]),a.push([c,d-1,4,e+2]),Y(c+1,d)&&Y(c,d+1)&&a.push([c+1,d+1,7,e+3]),Y(c-1,d)&&Y(c,d-1)&&a.push([c-1,d-1,3,e+3]),Y(c-1,d)&&
Y(c,d+1)&&a.push([c-1,d+1,1,e+3]),Y(c+1,d)&&Y(c,d-1)&&a.push([c+1,d-1,9,e+3]),G[c][d]=b[2]))}console.log(G)}function Y(a,b){return 0>a||0>b||a>=Q.length||b>=Q[0].length?!1:1!=Q[a][b]}function Z(a,b){return 0>a||0>b||a>=Q.length*H||b>=Q[0].length*H?!1:1!=Q[Math.floor(a/H)][Math.floor(b/H)]}function W(a,b){return Z(a-80,b-80)&&Z(a+80,b-80)&&Z(a-80,b+80)&&Z(a+80,b+80)};
