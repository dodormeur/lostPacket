var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a){if(a){for(var b=ba,c=["Array","prototype","fill"],d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&aa(b,c,{configurable:!0,writable:!0,value:a})}}
ca(function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}});
var g=function(){var a=document.documentElement.style,b=void 0!==a.WebkitTransform&&"-webkit-"||void 0!==a.MozTransform&&"-moz-"||void 0!==a.msTransform&&"-ms-"||"";return{translate:function(a,d,e,f,h,x){return b+"transform:translate3d("+a+"px,"+d+"px,"+e+"px)rotateX("+f+"deg)rotateY("+h+"deg)rotateZ("+x+"deg);"},origin:function(a,d,e){return b+"transform-origin:"+a+"px "+d+"px "+e+"px;"},m:function(a){return"background:"+a+";"}}}(),k=[];function l(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}
function m(){this.i=null;this.a=new l(0,0,0);this.b=new l(0,0,0)}m.prototype={};function n(a){a.i&&(a.i.node.style.cssText=g.origin(-a.a.x,-a.a.y,-a.a.z)+g.translate(a.a.x,a.a.y,700,a.b.x,a.b.y,a.b.z),k.forEach(function(b){b.node.style.cssText=g.translate(b.x,b.y,-b.z,270,90+180*-Math.atan2(-a.a.y-b.y,-a.a.x-b.x)/Math.PI,180)+"width:"+b.width+"px;height:"+b.height+"px;"}))}
function p(a,b,c,d,e,f,h,x,J){"div"==a?(this.node=document.createElement("div"),this.node.className="plane wall"):"ceil"==a?(this.node=document.createElement("div"),this.node.className="plane ceil"):"floor"==a?(this.node=document.createElement("div"),this.node.className="plane floor"):"background"==a?(this.node=document.createElement("canvas"),this.node.className="plane background",this.node.height=c/4,this.node.width=b/4):"glitch"==a?(this.node=document.createElement("canvas"),this.node.className=
"plane glitch"):"data"==a&&(this.node=document.createElement("canvas"),this.node.className="plane data");this.width=b;this.height=c;this.a=new l(d,e,f);this.b=new l(h,x,J);this.g=function(){this.node.style.cssText+="width:"+this.width+"px;height:"+this.height+"px;"+g.translate(this.a.x,this.a.y,this.a.z,this.b.x,this.b.y,this.b.z)};this.g()}
function da(a){this.node=document.createElement("div");this.node.className="world";a.node.appendChild(this.node);a.c.i=this;this.f=function(a){this.node.appendChild(a.node)};this.a=function(){this.node.innerHTML=""}}function ea(){var a=document.body;this.node=document.createElement("div");this.node.className="viewport";this.c=new m;a.appendChild(this.node)}
var q=[Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random()],r=[-20,20,60,100,140,180,220,260],t=[],u,v,w,y=0;
function z(){w=document.getElementsByClassName("background");.3>Math.random()&&(q.push(Math.random()),r.push(-20));for(var a=0;a<w.length;a++){var b=w[a];t[a]=b.getContext("2d");t[a].font="10px monospace";u=b.width;v=b.height;t[a].clearRect(0,0,u,v);for(b=0;b<q.length;b++)for(var c=0;7>c;c++)t[a].fillStyle="rgba(0,255,0,0."+(7-c)+")",t[a].fillText(Math.floor(9*Math.random()),q[b]*u,r[b]-10*c)}for(b=0;b<q.length;b++)r[b]+=4,r[b]>v+160&&(r.splice(b,1),q.splice(b,1),b--);setTimeout(z,100)}
function A(){for(var a=document.getElementsByClassName("glitch"),b=["#060760","#deec06","#ebecee","#061872","#0b0a0a"],c=0;c<a.length;c++){var d=a[c],e=d.getContext("2d"),f=d.width;d=d.height;e.clearRect(0,0,f,d);e.beginPath();e.fillStyle="darkGreen";a[c].classList.contains("targeting")&&(e.fillStyle="red");e.rect(f/4,d/4,f/2,d/2);e.fill();for(var h=0;5>h;h++){e.beginPath();e.fillStyle=b[Math.floor(Math.random()*b.length)];var x=Math.random()*f,J=Math.random()*d,W=Math.random()*f,X=Math.random()*
d;e.rect(Math.min(x,W),Math.min(J,X),Math.abs(x-W),Math.abs(J-X));e.fill()}}setTimeout(A,150)}
function B(){var a=document.getElementsByClassName("data");y+=10;200<y&&(y=10);for(var b=0;b<a.length;b++){var c=a[b],d=c.getContext("2d"),e=c.width,f=c.height;d.clearRect(0,0,e,f);c.width=200;c.height=500;d.font="20px monospace";d.fillStyle="white";d.fillText("Protect me",-y,f/2);d.fillText("Protect me",e-y,f/2);for(c=0;100>c;c++)d.fillText(Math.floor(9*Math.random()),e*Math.random(),f-(f/2-50)*Math.random());for(c=0;100>c;c++)d.fillText(Math.floor(9*Math.random()),e*Math.random(),(f/2-50)*Math.random())}setTimeout(B,
150)}
function fa(){C=[];D=0;var a;a:{var b=decodeURIComponent(document.cookie).split(";");for(a=0;a<b.length;a++){for(var c=b[a];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf("save=")){a=c.substring(5,c.length);break a}}a=""}if(a.constructor===String&&0<a.length&&(a=JSON.parse(a),a.constructor===Array)){D=a[0];0<D&&(document.getElementById("continueButton").className="option");for(b=1;b<a.length;b++)C.push(a[b]);if(0<C.length){a="<h2>Scores</h2>";for(b=0;b<C.length;b++)a+="<li>"+C[b]+" ticks</li>";document.getElementById("stats").innerHTML=
a;document.getElementById("statButton").className="option"}else document.getElementById("statButton").className="option option-disabled"}}
function ha(a,b){this.x=a;this.y=b;this.z=100;this.speed=2;this.height=this.width=300;this.h=!1;this.a=new p("glitch",300,300,this.x,this.y,this.z,270,270,180);this.node=this.a.node;E.f(this.a);k.push(this);this.frame=function(a,b){var c=!0;var d=this.x;var h=this.y;d=0>d||0>h||d>=F.length*G||h>=F[0].length*G?0:F[Math.floor(d/G)][Math.floor(h/G)];if(this.j(a,b,0))a=Math.atan2(b-this.y,a-this.x),this.node.className="plane glitch targeting";else{if(0==d||5==d)c=!1;a=(270+[-1,45,270,135,180,0,0,295,
90,225][d])*Math.PI/180;this.node.className="plane glitch"}c&&(this.x+=this.speed*Math.cos(a),this.y+=this.speed*Math.sin(a));return 5==d?!0:!1};this.j=function(a,b,e){return(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<e*e};this.delete=function(){this.node.remove();for(var a=0;a<k.length;a++)k[a]===this&&k.splice(a,1)}}var H=0,I=0,K=0,L=270,M=0,N=1E3,O=1E3,P=150,Q,F,G,R,S=[],C=[],D=0;
function ia(){ja(0);this.a=!1;this.l=function(){ja(1);this.a=!0;K=0};this.frame=function(){K++;document.getElementById("frameAlive").innerHTML=Math.floor(K/100);this.a?(T[83]?-10<H&&(H-=.2):T[90]?10>H&&(H+=.2):.4>Math.abs(H)?H=0:H/=1.1,T[81]?-10<I&&(I-=.2):T[68]?10>I&&(I+=.2):.4>Math.abs(I)?I=0:I/=1.1):(I=3,M-=.12);var a=Math.sin(.0174532925*M),b=Math.cos(.0174532925*M),c=N,d=O;N+=a*H;O+=b*H;P+=0;O-=a*I;N+=b*I;U(N,O)||(U(c,O)?N=c:U(N,d)?O=d:U(c,d)?(N=c,O=d):console.log("error !"));V&&console.log("mouse down !");
a=!1;for(b=0;b<R.length;b++)R[b].frame(N,O)?(a=!0,R[b].h=!0):R[b].j(N,O,100)&&(console.log("dead"),R[b].h=!0);for(b=R.length-1;0<=b;b--)R[b].h&&(R[b].delete(),R.splice(b,1));a&&this.g();1==K%1E3&&this.a&&S&&0<S.length&&(a=S[Math.floor(S.length*Math.random())],R.push(new ha(a.x,a.y)))};this.g=function(){console.log("data corrupted !")};this.b=function(a,b){L+=a;M+=b;230>L&&(L=230);320<L&&(L=320)}}var T={};window.onkeydown=function(a){a=a||window.event;T[a.keyCode]=!0};
window.onkeyup=function(a){a=a||window.event;delete T[a.keyCode]};var V=0;function ka(a,b,c,d){var e=E;e.f(new p(d,c,500,a+c,b,-447,270,90,180));e.f(new p(d,c,500,a+c,b+c,-447,270,0,180));e.f(new p(d,c,500,a,b,-447,270,180,180));e.f(new p(d,c,500,a,b+c,-447,270,270,180))}var E;
window.onload=function(){function a(b){if(1E3<b-f)window.requestAnimationFrame(a),f=b;else{h+=b-f;for(f=b;16<=h;)d.frame(),c.c.a.x=-N,c.c.a.y=-O,c.c.a.z=P,c.c.b.x=L,c.c.b.y=0,c.c.b.z=M,n(c.c),h-=16;window.requestAnimationFrame(a)}}function b(a){d.b(.5*-a.movementY,a.movementX/2)}document.body.onmousedown=function(){++V};document.body.onmouseup=function(){--V};fa();var c=new ea;E=new da(c);var d=new ia;c.c.a.x=0;c.c.a.y=0;c.c.a.z=150;c.c.b.x=270;c.c.b.y=0;c.c.b.z=0;n(c.c);document.getElementById("statButton").onclick=
function(){document.getElementById("stats").className="stats"};var e=document.getElementsByTagName("BODY")[0];e.requestPointerLock=e.requestPointerLock;document.getElementById("survivalButton").onclick=function(){e.onclick=function(){e.requestPointerLock()};e.requestPointerLock();document.getElementById("ingame").className="";d.l();document.getElementById("menu").classList.add("hidden")};document.addEventListener("pointerlockchange",function(){document.pointerLockElement===e?document.addEventListener("mousemove",
b,!1):document.removeEventListener("mousemove",b,!1)},!1);var f=0,h=0;a(0);z();A();B()};
function ja(a){S=[];G=400;0==a?(Q=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],O=N=700,M=45):1==a?(Q=[[3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0],[3,0,0,0,0,0,1,2,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0],[3,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,0,0,0,0,0,0]],N=1800,O=4200,M=180):2==a&&
(Q=[[0,0,0,0,2],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[3,0,0,0,0]],O=N=1800,M=180);R=[];la();a=Q;var b=G;E.a();var c=a.length*b,d=a[0].length*b;E.f(new p("floor",c,d,0,d,53,180,0,0));E.f(new p("ceil",c,d,0,0,-447,0,0,0));for(var e=0;e<a.length;e++)for(var f=0;f<a[e].length;f++)1==a[e][f]&&ka(e*b,f*b,b,"div"),2==a[e][f]&&ka(e*b+b/4,f*b+b/4,b/2,"data"),3==a[e][f]&&S.push({x:e*b+b/2,y:f*b+b/2});E.f(new p("background",d,500,0,0,-447,270,90,180));E.f(new p("background",c,500,c,0,-447,270,0,180));E.f(new p("background",
c,500,0,d,-447,270,180,180));E.f(new p("background",d,500,c,d,-447,270,270,180))}
function la(){F=[];for(var a=[],b=0;b<Q.length;b++){F.push([]);for(var c=0;c<Q[0].length;c++)2==Q[b][c]&&a.push([b,c,5,0]),F[b].push(-1)}for(;0<a.length;){a.sort(function(a,b){return a[3]-b[3]});b=a[0];a.splice(0,1);c=b[0];var d=b[1],e=b[3];0<=c&&c<Q.length&&0<=d&&d<Q[0].length&&(1==Q[c][d]?F[c][d]=0:-1==F[c][d]&&(a.push([c+1,d,2,e+2]),a.push([c-1,d,8,e+2]),a.push([c,d+1,6,e+2]),a.push([c,d-1,4,e+2]),Y(c+1,d)&&Y(c,d+1)&&a.push([c+1,d+1,7,e+3]),Y(c-1,d)&&Y(c,d-1)&&a.push([c-1,d-1,3,e+3]),Y(c-1,d)&&
Y(c,d+1)&&a.push([c-1,d+1,1,e+3]),Y(c+1,d)&&Y(c,d-1)&&a.push([c+1,d-1,9,e+3]),F[c][d]=b[2]))}console.log(F)}function Y(a,b){return 0>a||0>b||a>=Q.length||b>=Q[0].length?!1:1!=Q[a][b]}function Z(a,b){return 0>a||0>b||a>=Q.length*G||b>=Q[0].length*G?!1:1!=Q[Math.floor(a/G)][Math.floor(b/G)]}function U(a,b){return Z(a-80,b-80)&&Z(a+80,b-80)&&Z(a-80,b+80)&&Z(a+80,b+80)};
