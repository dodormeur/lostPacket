var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a){if(a){for(var b=ba,c=["Array","prototype","fill"],d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&aa(b,c,{configurable:!0,writable:!0,value:a})}}
ca(function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}});
var k=function(){var a=document.documentElement.style,b=void 0!==a.WebkitTransform&&"-webkit-"||void 0!==a.MozTransform&&"-moz-"||void 0!==a.msTransform&&"-ms-"||"";return{translate:function(a,d,e,f,p,t){return b+"transform:translate3d("+a+"px,"+d+"px,"+e+"px)rotateX("+f+"deg)rotateY("+p+"deg)rotateZ("+t+"deg);"},origin:function(a,d,e){return b+"transform-origin:"+a+"px "+d+"px "+e+"px;"},w:function(a){return"background:"+a+";"}}}(),l=[];function m(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}
function da(){this.m=null;this.a=new m(0,0,0);this.b=new m(0,0,0)}da.prototype={};function ea(a){a.m&&(a.m.node.style.cssText=k.origin(-a.a.x,-a.a.y,-a.a.z)+k.translate(a.a.x,a.a.y,700,a.b.x,a.b.y,a.b.z),l.forEach(function(b){b.active&&(b.node.style.cssText=k.translate(b.x,b.y,-b.z,270,90+180*-Math.atan2(-a.a.y-b.y,-a.a.x-b.x)/Math.PI,180)+"width:"+b.width+"px;height:"+b.height+"px;")}))}
function n(a,b,c,d,e,f,p,t,U){"div"==a?(this.node=document.createElement("div"),this.node.className="plane wall"):"ceil"==a?(this.node=document.createElement("div"),this.node.className="plane ceil"):"floor"==a?(this.node=document.createElement("div"),this.node.className="plane floor"):"background"==a?(this.node=document.createElement("canvas"),this.node.className="plane background",this.node.height=c/4,this.node.width=b/4):"glitch"==a?(this.node=document.createElement("canvas"),this.node.className=
"plane glitch"):"data"==a?(this.node=document.createElement("canvas"),this.node.className="plane data"):"shockwave"==a?(this.node=document.createElement("div"),this.node.className="plane shockwave",this.node.id="shockwave"):"bullet"==a&&(this.node=document.createElement("div"),this.node.className="plane bullet");this.width=b;this.height=c;this.a=new m(d,e,f);this.b=new m(p,t,U);this.g=function(){this.node.style.cssText+="width:"+this.width+"px;height:"+this.height+"px;"+k.translate(this.a.x,this.a.y,
this.a.z,this.b.x,this.b.y,this.b.z)};this.g()}function fa(a){this.node=document.createElement("div");this.node.className="world";a.node.appendChild(this.node);a.c.m=this;this.f=function(a){this.node.appendChild(a.node)};this.a=function(){this.node.innerHTML=""}}function ha(){var a=document.body;this.node=document.createElement("div");this.node.className="viewport";this.c=new da;a.appendChild(this.node)}
function ia(){var a=q,b=.0174532925*(90-r);this.x=u;this.y=a;this.a=b;this.z=150;this.height=this.width=100;this.speed=40;this.active=!0;this.b=new n("bullet",100,100,this.x,this.y,this.z,270,270,180);this.node=this.b.node;v.f(this.b);l.push(this);this.frame=function(){this.x+=this.speed*Math.cos(this.a);this.y+=this.speed*Math.sin(this.a);for(var a=!w(this.x,this.y),b=0;b<x.length;b++)x[b].i(this.x,this.y,200)&&(x[b].l(60),a=!0);return a?(this.active=!1,this.node.classList.add("hidden"),!0):!1};
this.set=function(a,b,e){this.x=a;this.y=b;this.a=e;this.active=!0;this.node.classList.remove("hidden")}}var y=[],z=0;
function ja(){A=[];B=0;var a;a:{var b=decodeURIComponent(document.cookie).split(";");for(a=0;a<b.length;a++){for(var c=b[a];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf("save=")){a=c.substring(5,c.length);break a}}a=""}if(a.constructor===String&&0<a.length&&(a=JSON.parse(a),a.constructor===Array)){B=a[0];0<B&&(document.getElementById("continueButton").className="option");for(b=1;b<a.length;b++)A.push(a[b]);if(0<A.length){a="<h2>Scores</h2>";for(b=0;b<A.length;b++)a+="<li>"+A[b]+" ticks</li>";
document.getElementById("stats").innerHTML=a;document.getElementById("statButton").className="option"}else document.getElementById("statButton").className="option option-disabled"}}function ka(){for(var a=[B],b=0;b<A.length;b++)a.push(A[b]);console.log(JSON.stringify(a));a=JSON.stringify(a);b=new Date;b.setTime(b.getTime()+31536E6);document.cookie="save="+a+";"+("expires="+b.toUTCString())+";path=/";ja()}
var C=[Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random()],D=[-20,20,60,100,140,180,220,260],E=[],la,ma,na,F=0;
function oa(){na=document.getElementsByClassName("background");.3>Math.random()&&(C.push(Math.random()),D.push(-20));for(var a=0;a<na.length;a++){var b=na[a];E[a]=b.getContext("2d");E[a].font="10px monospace";la=b.width;ma=b.height;E[a].clearRect(0,0,la,ma);for(b=0;b<C.length;b++)for(var c=0;7>c;c++)E[a].fillStyle="rgba(0,255,0,0."+(7-c)+")",E[a].fillText(Math.floor(9*Math.random()),C[b]*la,D[b]-10*c)}for(b=0;b<C.length;b++)D[b]+=4,D[b]>ma+160&&(D.splice(b,1),C.splice(b,1),b--);setTimeout(oa,100)}
function pa(){for(var a=document.getElementsByClassName("glitch"),b=["6,7,96","222,236,6","235,236,237","6,24,114","12,11,11"],c=0;c<a.length;c++){var d=a[c],e=d.getContext("2d"),f=d.width;d=d.height;e.clearRect(0,0,f,d);e.beginPath();e.fillStyle="darkGreen";a[c].classList.contains("targeting")&&(e.fillStyle="red");e.rect(f/4,d/4,f/2,d/2);e.fill();for(var p=0;5>p;p++){e.beginPath();e.fillStyle="rgba("+b[Math.floor(Math.random()*b.length)]+","+parseInt(a[c].classList[0],10)/100+")";var t=Math.random()*
f,U=Math.random()*d,g=Math.random()*f,h=Math.random()*d;e.rect(Math.min(t,g),Math.min(U,h),Math.abs(t-g),Math.abs(U-h));e.fill()}}setTimeout(pa,150)}
function qa(){var a=document.getElementsByClassName("data");F+=10;200<F&&(F=10);for(var b=0;b<a.length;b++){var c=a[b],d=c.getContext("2d"),e=c.width,f=c.height;d.clearRect(0,0,e,f);c.width=200;c.height=500;d.font="20px monospace";d.fillStyle="white";d.fillText("Protect me",-F,f/2);d.fillText("Protect me",e-F,f/2);for(c=0;100>c;c++)d.fillText(Math.floor(9*Math.random()),e*Math.random(),f-(f/2-50)*Math.random());for(c=0;100>c;c++)d.fillText(Math.floor(9*Math.random()),e*Math.random(),(f/2-50)*Math.random())}setTimeout(qa,
150)}
function ra(a,b){this.x=a;this.y=b;this.b=0;this.a=this.z=100;this.j=.01+G/1E3;this.speed=2+G/10;this.height=this.width=300;this.h=!1;this.g=new n("glitch",300,300,this.x,this.y,this.z,270,270,180);this.node=this.g.node;v.f(this.g);l.push(this);this.active=!0;this.frame=function(a,b){this.b++;var c=!0;var d=this.x;var p=this.y;d=0>d||0>p||d>=H.length*I||p>=H[0].length*I?0:H[Math.floor(d/I)][Math.floor(p/I)];this.a+=this.j;100<this.a&&(this.a=100);if(this.i(a,b,400))a=Math.atan2(b-this.y,a-this.x),this.node.className=
this.a+" plane glitch targeting";else{if(0==d||5==d)c=!1;a=(270+[-1,45,270,135,180,0,0,295,90,225][d])*Math.PI/180;this.node.className=this.a+" plane glitch"}c&&(this.x+=this.speed*Math.cos(a),this.y+=this.speed*Math.sin(a));return 5==d?!0:!1};this.i=function(a,b,e){return(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<e*e};this.delete=function(){this.node.remove();for(var a=0;a<l.length;a++)l[a]===this&&l.splice(a,1)};this.l=function(a){this.a-=a;0>=this.a&&(this.h=!0)};this.o=function(){var a=u,b=q,
e=r,f=a+100*Math.sin(.0174532925*e);e=b+100*Math.cos(.0174532925*e);var p=this.x,t=this.y;console.log(a+" "+b+" "+f+" "+e);300>Math.abs((e-b)*p-(f-a)*t+f*b-e*a)/Math.sqrt((e-b)*(e-b)+(f-a)*(f-a))&&this.l(1.5)};this.s=function(){var a=J,b=K,e=L;this.b>sa&&e*e>=(a-this.x)*(a-this.x)+(b-this.y)*(b-this.y)&&(this.b=0,this.l(99))}}var M=0,N=0,O=0,P=270,r=0,u=1E3,q=1E3,ta=150,Q,H,I,x,R=[],A=[],B=0,S=0,T=[20,80,200],V=0,J=0,K=0,L=-1,sa=0,W=500,G=0,X=87,ua=83,va=65,wa=68,xa=0;
function ya(){za(0);this.a=!1;this.g=!0;this.v=function(){za(1);this.a=!0;this.g=!1;G=O=0;W=500};this.frame=function(){sa++;document.getElementById("frameAlive").innerHTML=Math.floor(O/100);this.a?(O++,Y[ua]?-10<M&&(M-=.2):Y[X]?10>M&&(M+=.2):.4>Math.abs(M)?M=0:M/=1.1,Y[va]?-10<N&&(N-=.2):Y[wa]?10>N&&(N+=.2):.4>Math.abs(N)?N=0:N/=1.1):this.g&&(N=3,r-=.12);var a=Math.sin(.0174532925*r),b=Math.cos(.0174532925*r),c=u,d=q;u+=a*M;q+=b*M;ta+=0;q-=a*N;u+=b*N;Aa(u,q)||(Aa(c,q)?u=c:Aa(u,d)?q=d:Aa(c,d)?(u=c,
q=d):console.log("error !"));1==V&&document.getElementById("laserbeam").classList.remove("laserbeamActive");0<V&&V--; -1!=L&&(L+=30,2E3<=L&&(L=-1));for(a=0;a<z&&a<y.length;a++)y[a].frame()&&(z--,a!=z&&(b=y[a],y[a]=y[z],y[z]=b,a--));if((Ba||Y[32])&&this.a)S++;else{for(a=T.length-1;0<=a;a--)if(S>T[a]){this.u(a);break}S=0}b=!1;for(a=0;a<x.length;a++)x[a].frame(u,q)?(b=!0,x[a].h=!0):x[a].i(u,q,100)&&(this.b(),x[a].h=!0),0<V&&x[a].o(),-1!=L&&x[a].s();for(a=x.length-1;0<=a;a--)x[a].h&&(x[a].delete(),x.splice(a,
1));b&&this.b();1==O%W&&this.a&&(console.log("spawning "+W),400<W&&(W-=5),300<W&&(W-=5),200<W&&(W-=5),150<W&&(W-=3),100<W&&W--,50<W&&W--,G++,R&&0<R.length&&(a=R[Math.floor(R.length*Math.random())],x.push(new ra(a.x,a.y))))};this.u=function(a){switch(a){case 0:z<y.length?y[z].set(u,q,.0174532925*(90-r)):y.push(new ia);z++;break;case 1:J=u;K=q;L=sa=0;break;case 2:V=180,document.getElementById("laserbeam").classList.add("laserbeamActive")}};this.b=function(){if(this.a){N=M=0;var a=Math.floor(O/100);
document.exitPointerLock();document.getElementsByTagName("BODY")[0].onclick=function(){return!1};this.a=!1;document.getElementById("gameOver").classList.remove("hidden");document.getElementById("ingame").classList.add("hidden");document.getElementById("score").innerHTML=a;for(var b=!0,c=0;c<A.length;c++)if(a>=A[c]){A.splice(c,0,a);document.getElementById("scorePosition").innerHTML="you are number "+(c+1)+" in the leaderboard !";b=!1;break}10>A.length&&b&&(document.getElementById("scorePosition").innerHTML=
"you are number "+(A.length+1)+" in the leaderboard !",A.push(a));10<=A.length&&A.splice(-1,1);ka();document.getElementById("gameOver").onclick=function(){document.getElementById("gameOver").classList.add("hidden");document.getElementById("menu").classList.remove("hidden")}}};this.j=function(a,b){P+=a;r+=b;230>P&&(P=230);320<P&&(P=320)}}var Y={};window.onkeydown=function(a){a=a||window.event;Y[a.keyCode]=!0};window.onkeyup=function(a){a=a||window.event;delete Y[a.keyCode]};var Ba=0;
function Ca(a,b,c,d){var e=v;e.f(new n(d,c,500,a+c,b,-447,270,90,180));e.f(new n(d,c,500,a+c,b+c,-447,270,0,180));e.f(new n(d,c,500,a,b,-447,270,180,180));e.f(new n(d,c,500,a,b+c,-447,270,270,180))}var v;
function Da(){xa++;xa%=3;switch(xa){case 1:X=90;ua=83;va=81;wa=68;document.getElementById("keyboardType").innerHTML="azerty";break;case 0:X=87;ua=83;va=65;wa=68;document.getElementById("keyboardType").innerHTML="qwerty";break;case 2:X=38,ua=40,va=37,wa=39,document.getElementById("keyboardType").innerHTML="arrows"}}
window.onload=function(){function a(b){if(1E3<b-f)window.requestAnimationFrame(a),f=b;else{p+=b-f;for(f=b;16<=p;)d.frame(),c.c.a.x=-u,c.c.a.y=-q,c.c.a.z=ta,c.c.b.x=P,c.c.b.y=0,c.c.b.z=r,ea(c.c),p-=16;var e=document.getElementById("attackLoader");b=e.getContext("2d");var g=e.offsetWidth,h=e.offsetHeight,t=g/h;b.clearRect(0,0,g,h);1>t?(e.width=800,e.height=800/t,g=800,h=800/t):(e.width=800*t,e.height=800,g=800*t,h=800);b.strokeStyle="rgba(255,255,255,0.4)";b.lineWidth=3;b.beginPath();b.arc(g/2,h/2,
5,0,2*Math.PI);b.stroke();b.strokeStyle="rgba(255,255,255,1)";0<S&&(e=S/T[0],b.lineWidth=3,b.beginPath(),b.arc(g/2,h/2,5,0,2*Math.PI*e),b.stroke());S>T[0]&&(b.lineWidth=4,b.beginPath(),b.arc(g/2,h/2,5,0,2*Math.PI),b.stroke(),b.strokeStyle="rgba(255,255,255,0.7)",e=(S-T[0])/(T[1]-T[0]),b.lineWidth=3,b.beginPath(),b.arc(g/2,h/2,10,0,2*Math.PI*e),b.stroke());S>T[1]&&(b.lineWidth=4,b.beginPath(),b.arc(g/2,h/2,10,0,2*Math.PI),b.stroke(),b.strokeStyle="rgba(255,255,255,0.7)",e=(S-T[1])/(T[2]-T[1]),b.lineWidth=
3,b.beginPath(),b.arc(g/2,h/2,15,0,2*Math.PI*e),b.stroke());S>T[2]&&(b.lineWidth=4,b.beginPath(),b.arc(g/2,h/2,15,0,2*Math.PI),b.stroke());1!=L&&(b=L/4E3*100,document.getElementById("shockwave").style.cssText="width: 4000px;height: 4000px;"+k.translate(J-2E3,K+2E3,-20,180,0,0)+"background: radial-gradient(circle at 50%, transparent, transparent "+(b-10)+"%, #eee "+b+"%, transparent "+b+"%);");g=document.getElementById("minimap");b=g.getContext("2d");b.clearRect(0,0,g.width,g.height);b.fillStyle="rgba(120,120,120,0.8)";
g=100/(Q.length*I);b.fillRect(0,0,100,100/((Q.length+0)/(0+Q[0].length)));b.fillStyle="blue";b.fillRect(u*g,q*g,5,5);b.fillStyle="red";for(h=0;h<x.length;h++)b.fillRect(x[h].x*g,x[h].y*g,3,3);b.fillStyle="green";for(h=0;h<y.length;h++)y[h].active&&b.fillRect(y[h].x*g,y[h].y*g,3,3);b.strokeStyle="green";b.lineWidth=2;-1!=L&&(b.beginPath(),b.arc(J*g,K*g,L*g,0,2*Math.PI),b.stroke());window.requestAnimationFrame(a)}}function b(a){d.j(.5*-a.movementY,a.movementX/2)}document.body.onmousedown=function(){++Ba};
document.body.onmouseup=function(){--Ba};ja();var c=new ha;v=new fa(c);var d=new ya;c.c.a.x=0;c.c.a.y=0;c.c.a.z=150;c.c.b.x=270;c.c.b.y=0;c.c.b.z=0;ea(c.c);Da();document.getElementById("keyboardButton").onclick=Da;document.getElementById("statButton").onclick=function(){document.getElementById("stats").className="stats"};var e=document.getElementsByTagName("BODY")[0];e.requestPointerLock=e.requestPointerLock;document.getElementById("survivalButton").onclick=function(){e.onclick=function(){e.requestPointerLock()};
e.requestPointerLock();document.getElementById("ingame").className="";d.v();document.getElementById("menu").classList.add("hidden")};document.addEventListener("pointerlockchange",function(){document.pointerLockElement===e?document.addEventListener("mousemove",b,!1):document.removeEventListener("mousemove",b,!1)},!1);var f=0,p=0;a(0);oa();pa();qa()};
function za(a){R=[];I=400;0==a?(Q=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],q=u=700,r=45):1==a?(Q=[[3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0],[3,0,0,0,0,0,1,2,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0],[3,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,0,0,0,0,0,0]],u=1800,q=4200,r=180):2==a&&
(Q=[[0,0,0,0,2],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[3,0,0,0,0]],q=u=1800,r=180);x=[];Ea();a=Q;var b=I;v.a();y=[];z=0;var c=a.length*b,d=a[0].length*b;v.f(new n("floor",c,d,0,d,53,180,0,0));v.f(new n("ceil",c,d,0,0,-447,0,0,0));v.f(new n("shockwave",4E3,4E3,0,0,-80,180,0,0));for(var e=0;e<a.length;e++)for(var f=0;f<a[e].length;f++)1==a[e][f]&&Ca(e*b,f*b,b,"div"),2==a[e][f]&&Ca(e*b+b/4,f*b+b/4,b/2,"data"),3==a[e][f]&&R.push({x:e*b+b/2,y:f*b+b/2});v.f(new n("background",d,500,0,0,-447,270,90,180));
v.f(new n("background",c,500,c,0,-447,270,0,180));v.f(new n("background",c,500,0,d,-447,270,180,180));v.f(new n("background",d,500,c,d,-447,270,270,180))}
function Ea(){H=[];for(var a=[],b=0;b<Q.length;b++){H.push([]);for(var c=0;c<Q[0].length;c++)2==Q[b][c]&&a.push([b,c,5,0]),H[b].push(-1)}for(;0<a.length;){a.sort(function(a,b){return a[3]-b[3]});b=a[0];a.splice(0,1);c=b[0];var d=b[1],e=b[3];0<=c&&c<Q.length&&0<=d&&d<Q[0].length&&(1==Q[c][d]?H[c][d]=0:-1==H[c][d]&&(a.push([c+1,d,2,e+2]),a.push([c-1,d,8,e+2]),a.push([c,d+1,6,e+2]),a.push([c,d-1,4,e+2]),Z(c+1,d)&&Z(c,d+1)&&a.push([c+1,d+1,7,e+3]),Z(c-1,d)&&Z(c,d-1)&&a.push([c-1,d-1,3,e+3]),Z(c-1,d)&&
Z(c,d+1)&&a.push([c-1,d+1,1,e+3]),Z(c+1,d)&&Z(c,d-1)&&a.push([c+1,d-1,9,e+3]),H[c][d]=b[2]))}}function Z(a,b){return 0>a||0>b||a>=Q.length||b>=Q[0].length?!1:1!=Q[a][b]}function w(a,b){return 0>a||0>b||a>=Q.length*I||b>=Q[0].length*I?!1:1!=Q[Math.floor(a/I)][Math.floor(b/I)]}function Aa(a,b){return w(a-80,b-80)&&w(a+80,b-80)&&w(a-80,b+80)&&w(a+80,b+80)};
